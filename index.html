<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>JS ISO</title>
		<script type="text/javascript" src="lib/jquery-1.3.2.js"></script>
		<script type="text/javascript" src="lib/RenderQueue.js"></script>
		<script type="text/javascript" src="lib/CarterHenry.js"></script>
		<script type="text/javascript" src="lib/Collection.js"></script>
		<script type="text/javascript" src="lib/Heap.js"></script>
		<script type="text/javascript" src="lib/HeapIterator.js"></script>
		<script type="text/javascript" src="lib/Array2.js"></script>
		<script type="text/javascript" src="lib/Array2Iterator.js"></script>
		<script type="text/javascript" src="lib/Graph.js"></script>
		<script type="text/javascript" src="lib/GraphNode.js"></script>
		<script type="text/javascript" src="lib/GraphArc.js"></script>
		<script type="text/javascript" src="lib/GraphNodePointer.js"></script>
		<script type="text/javascript" src="lib/Waypoint.js"></script>
		<script type="text/javascript" src="lib/AStarLine.js"></script>
		<script type="text/javascript" src="tiles.js"></script>
		<script type="text/javascript" src="map.js"></script>
		<script type="text/javascript">
			var carter_henry;
			var canvas = {background_color:"#77AA00", width:930, height:445};
			var graph, nav;
			var hero, cursor, villian;
			jQuery(document).ready(function(){
				var perspective = {top:jQuery("#world_canvas").attr("height") >> 2, left:jQuery("#world_canvas").attr("width") >> 1}
				carter_henry = new CarterHenry("world_canvas", map, tile_data, perspective, canvas);
				hero = carter_henry.add_sprite("HeroSprite", 2, 2);
				villian = carter_henry.add_sprite("VillianSprite", 13, 9);
				
				init_graph();
				
				carter_henry.timer = setInterval("carter_henry.render()", 70);
			});
			function to_index(x, y){
				return x + y * map.data[0].length;
			};
			function from_index(index){
				var y = Math.floor(index / map.data[0].length);
				return {y:y, x:index - y * map.data[0].length};
			};
			function init_graph(){
				graph = new Graph(map.data.length * map.data[0].length);
				nav = new AStarLine();
				var waypoint;
				for(var y = 0; y < map.data.length; y++){
					for(var x = 0; x < map.data[y].length; x++){
						waypoint = new Waypoint(to_index(x, y));
						waypoint.setPos(x, y);
						graph.addNode(waypoint, to_index(x, y))
					};
				};
				network_graph();
			};
			function network_graph(){
				var index;
				for(var y = 0; y < map.data.length; y++){
					for(var x = 0; x < map.data[y].length; x++){
						index = to_index(x, y);
						if(y - 1 > -1 && map.data[y - 1][x] == 0) graph.addArc(index, to_index(x, y - 1));
						if(y + 1 < map.data.length && map.data[y + 1][x] == 0) graph.addArc(index, to_index(x, y + 1));
						if(x - 1 > -1 && map.data[y][x - 1] == 0) graph.addArc(index, to_index(x - 1, y));
						if(x + 1 < map.data[y].length && map.data[y][x + 1] == 0) graph.addArc(index, to_index(x + 1, y));
					};
				};
			};
		</script>
		<style type="text/css">
			#world_canvas{cursor:default;}
		</style>
	</head>
	<body>
		<canvas id="world_canvas" width="930" height="445">
			Oops, No Canvas Support
		</canvas>
	</body>
</html>